{"version":3,"file":"auth-B9ahW_DP.js","sources":["../../../../middleware/auth.ts"],"sourcesContent":["// middleware/auth.js\nimport { defineNuxtRouteMiddleware, abortNavigation, navigateTo } from 'nuxt/app'\nimport { useAuthStore } from '../stores/authStore'\n\nexport default defineNuxtRouteMiddleware(async (to, from) => {\n    try {\n        const response = await fetch(\"/api/me\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            credentials: 'include' // บอกให้เบราว์เซอร์ส่งคุกกี้ไปพร้อมกับคำขอ\n\n        })\n        // console.log(response.status == 401);\n\n        if (response.status == 401) {\n            return await navigateTo(\"/auth/login\")\n        }\n        const data = await response.json()\n\n        useAuthStore().setUser(data.user)\n\n\n\n    } catch (error) {\n        console.log(error);\n    }\n\n})\n"],"names":["__executeAsync"],"mappings":";;;;;;;;;;;;;;;;;;;;AAKI,MAAA,OAAI,0BAAA,OAAA,IAAA,SAAA;AAAA,MAAA,QAAA;AACM,MAAA;AAAkC,UAC5B,YAAA,CAAA,QAAA,SAAA,IAAAA,aAAA,MAAA,MAAA,WAAA;AAAA,MACR,QAAS;AAAA,MAAA,SACW;AAAA,QACpB,gBAAA;AAAA,MACa;AAAA,MAAA,aAAA;AAAA;AAAA,IAKjB,CAAI,CAAA,GAAA,SAAA,cAAwB,UAAA,GAAA;AACjB,QAAA,SAAM,UAAA,KAAA;AACjB,aAAA,CAAA,QAAA,SAAA,IAAAA,aAAA,MAAA,WAAA,aAAA,CAAA,GAAA,SAAA,MAAA,QAAA,UAAA,GAAA;AAAA,IACM;AAEO,UAAA,QAAE,CAAQ,QAAA,SAAS,IAAAA,aAAA,MAAA,SAAA,KAAA,CAAA,GAAA,SAAA,MAAA,QAAA,UAAA,GAAA;mBAIpB,QAAA,KAAA,IAAA;AAAA,EACZ,SAAA,OAAiB;AACrB,YAAA,IAAA,KAAA;AAAA,EAEH;;"}